{
    "Description": "(SO0124) - AWS Streaming Data Solution for Amazon Kinesis (KDS -> KDA -> APIGW). Version v1.6.0",
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Amazon Kinesis Data Analytics configuration"
                    },
                    "Parameters": [
                        "LogLevel",
                        "MetricsLevel",
                        "EnableSnapshots",
                        "RetentionCount",
                        "EnableAutoScaling",
                        "s3bucket",
                        "artifactName",
                        "lambdaName",
                        "generateUsersTimer",
                        "pauseBetweenUserGeneration"
                    ]
                }
            ],
            "ParameterLabels": {
                "RetentionCount": {
                    "default": "Number of snapshots to retain in KDA"
                },
                "LogLevel": {
                    "default": "Monitoring log level"
                },
                "MetricsLevel": {
                    "default": "Monitoring metrics level"
                },
                "EnableSnapshots": {
                    "default": "Enable service-triggered snapshots"
                },
                "EnableAutoScaling": {
                    "default": "Enable automatic scaling"
                },
                "s3bucket": {
                    "default": "Name of the S3 bucket where application artifacts are uploaded"
                },
                "artifactName": {
                    "default": "Name of the Java application artifact"
                },
                "lambdaName": {
                    "default": "Name of the Zip archive containing Lambda code"
                },
                "generateUsersTimer": {
                    "default": "How long to generate user data in seconds"
                },
                "pauseBetweenUserGeneration": {
                    "default": "Delay between data generation in ms"
                }
            }
        }
    },
    "Parameters": {
        "RetentionCount": {
            "Type": "Number",
            "Default": 10,
            "MaxValue": 1000,
            "MinValue": 3
        },
        "LogLevel": {
            "Type": "String",
            "Default": "INFO",
            "AllowedValues": [
                "DEBUG",
                "ERROR",
                "INFO",
                "WARN"
            ]
        },
        "MetricsLevel": {
            "Type": "String",
            "Default": "TASK",
            "AllowedValues": [
                "APPLICATION",
                "OPERATOR",
                "PARALLELISM",
                "TASK"
            ]
        },
        "EnableSnapshots": {
            "Type": "String",
            "Default": "true",
            "AllowedValues": [
                "true",
                "false"
            ]
        },
        "EnableAutoScaling": {
            "Type": "String",
            "Default": "true",
            "AllowedValues": [
                "true",
                "false"
            ]
        },
        "s3bucket": {
            "Type": "String"
        },
        "artifactName": {
            "Type": "String"
        },
        "lambdaName": {
            "Type": "String"
        },
        "generateUsersTimer": {
            "Type": "Number",
            "Default": 60
        },
        "pauseBetweenUserGeneration": {
            "Type": "Number",
            "Default": 1500
        },
        "TopicName": {
            "Type": "String",
            "Description": "SNS Topic Name",
            "Default": "KDASnapshotNotification"
        },
        "DashboardName": {
            "Type": "String",
            "Description": "CloudWatch Dashboard Name",
            "Default": "KDA-Snapshot-Dashboard"
        },
        "MailAddress": {
            "Type": "String",
            "Description": "Email where to send notifications",
            "Default": "P3250035@ness.com"
        }
    },
    "Resources": {
        "KdaAppRole8C4B7E53": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": "sts:AssumeRole",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "kinesisanalytics.amazonaws.com"
                            }
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "Policies": [
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "s3:GetObjectVersion",
                                        "s3:GetObject"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:",
                                                {
                                                    "Ref": "AWS::Partition"
                                                },
                                                ":s3:::",
                                                {
                                                    "Ref": "s3bucket"
                                                },
                                                "/",
                                                {
                                                    "Ref": "artifactName"
                                                }
                                            ]
                                        ]
                                    }
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "S3Policy"
                    },
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": "logs:DescribeLogGroups",
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:",
                                                {
                                                    "Ref": "AWS::Partition"
                                                },
                                                ":logs:",
                                                {
                                                    "Ref": "AWS::Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AWS::AccountId"
                                                },
                                                ":log-group:*"
                                            ]
                                        ]
                                    }
                                },
                                {
                                    "Action": [
                                        "logs:DescribeLogStreams",
                                        "logs:PutLogEvents"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::GetAtt": [
                                            "KdaLogGroup3CE88219",
                                            "Arn"
                                        ]
                                    }
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "LogsPolicy"
                    }
                ]
            },
            "Metadata": {
                "cfn_nag": {
                    "rules_to_suppress": [
                        {
                            "id": "W11",
                            "reason": "EC2 actions in VPC policy do not support resource level permissions"
                        }
                    ]
                }
            }
        },
        "KdaLogGroup3CE88219": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "RetentionInDays": 365
            },
            "UpdateReplacePolicy": "Retain",
            "DeletionPolicy": "Retain",
            "Metadata": {
                "cfn_nag": {
                    "rules_to_suppress": [
                        {
                            "id": "W84",
                            "reason": "Log group data is always encrypted in CloudWatch Logs using an AWS Managed KMS Key"
                        }
                    ]
                }
            }
        },
        "KdaLogStreamDE21D9F7": {
            "Type": "AWS::Logs::LogStream",
            "Properties": {
                "LogGroupName": {
                    "Ref": "KdaLogGroup3CE88219"
                }
            },
            "UpdateReplacePolicy": "Retain",
            "DeletionPolicy": "Retain",
            "Metadata": {
                "aws:cdk:path": "aws-streaming-data-solution-for-kinesis-using-kinesis-data-analytics-and-api-gateway/Kda/LogStream/Resource"
            }
        },
        "KdaLoggingEAF1BAAE": {
            "Type": "AWS::KinesisAnalyticsV2::ApplicationCloudWatchLoggingOption",
            "Properties": {
                "ApplicationName": {
                    "Ref": "KdaApplication28F664DA"
                },
                "CloudWatchLoggingOption": {
                    "LogStreamARN": {
                        "Fn::Join": [
                            "",
                            [
                                "arn:",
                                {
                                    "Ref": "AWS::Partition"
                                },
                                ":logs:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":",
                                {
                                    "Ref": "AWS::AccountId"
                                },
                                ":log-group:",
                                {
                                    "Ref": "KdaLogGroup3CE88219"
                                },
                                ":log-stream:",
                                {
                                    "Ref": "KdaLogStreamDE21D9F7"
                                }
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "aws:cdk:path": "aws-streaming-data-solution-for-kinesis-using-kinesis-data-analytics-and-api-gateway/Kda/Logging"
            }
        },
        "KdaApplication28F664DA": {
            "Type": "AWS::KinesisAnalyticsV2::Application",
            "Properties": {
                "RuntimeEnvironment": "FLINK-1_13",
                "ServiceExecutionRole": {
                    "Fn::GetAtt": [
                        "KdaAppRole8C4B7E53",
                        "Arn"
                    ]
                },
                "ApplicationConfiguration": {
                    "ApplicationCodeConfiguration": {
                        "CodeContent": {
                            "S3ContentLocation": {
                                "BucketARN": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "arn:",
                                            {
                                                "Ref": "AWS::Partition"
                                            },
                                            ":s3:::",
                                            {
                                                "Ref": "s3bucket"
                                            }                                            
                                        ]
                                    ]
                                },
                                "FileKey": {
                                    "Ref": "artifactName"
                                }
                            }
                        },
                        "CodeContentType": "ZIPFILE"
                    },
                    "ApplicationSnapshotConfiguration": {
                        "SnapshotsEnabled": {
                            "Fn::If": [
                                "KdaEnableSnapshots603427DA",
                                true,
                                false
                            ]
                        }
                    },
                    "EnvironmentProperties": {
                        "PropertyGroups": [
                            {
                                "PropertyMap": {
                                    "generateUsersTimer": {
                                        "Ref": "generateUsersTimer"
                                    },
                                    "pauseBetweenUserGeneration": {
                                        "Ref": "pauseBetweenUserGeneration"
                                    }
                                },
                                "PropertyGroupId": "FlinkApplicationProperties"
                            }
                        ]
                    },
                    "FlinkApplicationConfiguration": {
                        "CheckpointConfiguration": {
                            "ConfigurationType": "DEFAULT"
                        },
                        "MonitoringConfiguration": {
                            "ConfigurationType": "CUSTOM",
                            "LogLevel": {
                                "Ref": "LogLevel"
                            },
                            "MetricsLevel": {
                                "Ref": "MetricsLevel"
                            }
                        },
                        "ParallelismConfiguration": {
                            "AutoScalingEnabled": {
                                "Fn::If": [
                                    "KdaEnableAutoScaling70CD99E0",
                                    true,
                                    false
                                ]
                            },
                            "ConfigurationType": "CUSTOM"
                        }
                    }
                }
            },
            "Metadata": {
                "aws:cdk:path": "aws-streaming-data-solution-for-kinesis-using-kinesis-data-analytics-and-api-gateway/Kda/Application"
            }
        },
        "SnapshotsNotificationSNSTopic": {
            "Type": "AWS::SNS::Topic",
            "Properties": {
                "Subscription": [
                    {
                        "Endpoint": {
                            "Ref": "MailAddress"
                        },
                        "Protocol": "email"
                    }
                ],
                "TopicName": {
                    "Ref": "TopicName"
                }
            }
        },
        "SnapshotTable": {
            "Type": "AWS::DynamoDB::Table",
            "Properties": {
                "TableName": "snapshot_manager_status",
                "AttributeDefinitions": [
                    {
                        "AttributeName": "app_name",
                        "AttributeType": "S"
                    },
                    {
                        "AttributeName": "snapshot_manager_run_id",
                        "AttributeType": "N"
                    }
                ],
                "KeySchema": [
                    {
                        "AttributeName": "app_name",
                        "KeyType": "HASH"
                    },
                    {
                        "AttributeName": "snapshot_manager_run_id",
                        "KeyType": "RANGE"
                    }
                ],
                "ProvisionedThroughput": {
                    "ReadCapacityUnits": 5,
                    "WriteCapacityUnits": 5
                }
            }
        },
        "KDALambdaRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "lambda.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "RoleName": "kda_snapshot_manager_role"
            }
        },
        "DynamoDBPolicy": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": "kda_policy_dynamodb",
                "Roles": [
                    {
                        "Ref": "KDALambdaRole"
                    }
                ],
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "dynamodb:BatchWriteItem",
                                "dynamodb:PutItem",
                                "dynamodb:DeleteItem",
                                "dynamodb:UpdateItem"
                            ],
                            "Resource": {
                                "Fn::GetAtt": [
                                    "SnapshotTable",
                                    "Arn"
                                ]
                            }
                        }
                    ]
                }
            }
        },
        "SNSPolicy": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": "kda_policy_sns",
                "Roles": [
                    {
                        "Ref": "KDALambdaRole"
                    }
                ],
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "sns:Publish"
                            ],
                            "Resource": {
                                "Ref": "SnapshotsNotificationSNSTopic"
                            }
                        }
                    ]
                }
            }
        },
        "KDAPolicy": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": "kda_policy_analytics",
                "Roles": [
                    {
                        "Ref": "KDALambdaRole"
                    }
                ],
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "kinesisanalytics:ListApplicationSnapshots",
                                "kinesisanalytics:DescribeApplicationSnapshot",
                                "kinesisanalytics:DescribeApplication",
                                "kinesisanalytics:DeleteApplicationSnapshot",
                                "kinesisanalytics:CreateApplicationSnapshot"
                            ],
                            "Resource": {
                                "Fn::Join": [
                                    "",
                                    [
                                        "arn:",
                                        {
                                            "Ref": "AWS::Partition"
                                        },
                                        ":kinesisanalytics:",
                                        {
                                            "Ref": "AWS::Region"
                                        },
                                        ":",
                                        {
                                            "Ref": "AWS::AccountId"
                                        },
                                        ":application/",
                                        {
                                            "Ref": "KdaApplication28F664DA"
                                        }
                                    ]
                                ]
                            }
                        }
                    ]
                }
            }
        },

        
        "InvokeLambdaPermission": {
            "Type": "AWS::Lambda::Permission",
            "Properties": {
              "FunctionName": {
                "Fn::GetAtt": [
                  "SnapshotmanagerLambda",
                  "Arn"
                ]
              },
              "Action": "lambda:InvokeFunction",
              "Principal": "events.amazonaws.com",
              "SourceArn": {
                "Fn::GetAtt": [
                  "kdaSnapshots",
                  "Arn"
                ]
              }
            }
        },


        "CWPolicy": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": "kda_policy_cw",
                "Roles": [
                    {
                        "Ref": "KDALambdaRole"
                    }
                ],
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "logs:CreateLogStream",
                                "logs:CreateLogGroup",
                                "logs:PutLogEvents",
                                "cloudwatch:PutMetricData"
                            ],
                            "Resource": "*"
                        }
                    ]
                }
            }
        },
        "SnapshotmanagerLambda": {
            "Type": "AWS::Lambda::Function",
            "Properties": {
                "Description": "Snapshot Manager to create and expire KDA snapshots",
                "FunctionName": "kda_snapshot_manager",
                "Handler": "amazon_kinesis_data_analytics_for_apache_flink_snapshot_manager.lambda_handler",
                "MemorySize": 128,
                "Role": {
                    "Fn::GetAtt": [
                        "KDALambdaRole",
                        "Arn"
                    ]
                },
                "Runtime": "python3.7",
                "Timeout": 300,
                "Environment": {
                    "Variables": {
                        "aws_region": {
							"Ref": "AWS::Region"
						},
                        "app_name": {
                            "Ref": "KdaApplication28F664DA"
                        },
                        "snapshot_manager_ddb_table_name": "snapshot_manager_status",
                        "primary_partition_key_name": "app_name",
                        "primary_sort_key_name": "snapshot_manager_run_id",
                        "sns_topic_arn": {
                            "Ref": "SnapshotsNotificationSNSTopic"
                        },
                        "number_of_older_snapshots_to_retain": {
                            "Ref": "RetentionCount"
                        },
                        "snapshot_creation_wait_time_seconds": 15
                    }
                },
                "Code": {
                    "S3Bucket": {
                        "Ref": "s3bucket"
                    },
                    "S3Key": {
                        "Ref": "lambdaName"
                    }
                }
            }
        },
        "kdaSnapshots": {
            "Type": "AWS::Events::Rule",
            "Properties": {
                "Name": "kda-snapshots",
                "Description": "Take ascheduled snapshot of KDA app",
                "State": "ENABLED",
                "ScheduleExpression": "rate(10 minutes)",
                "Targets": [
                    {
                        "Arn": {
                            "Fn::GetAtt": [
                                "SnapshotmanagerLambda",
                                "Arn"
                            ]
                        },
                        "Input": "{\"operation\":\"call-lambda\"}",
                        "Id": "Id123"
                    }
                ]
            }
        },
        "MonitoringDashboard0C3675C6": {
            "Type": "AWS::CloudWatch::Dashboard",
            "Properties": {
                "DashboardName": {
                    "Ref": "DashboardName"
                },
                "DashboardBody": {
                    "Fn::Join": [
                        "",
                        [
                            "{\"widgets\":[{\"type\":\"metric\",\"x\":0,\"y\":0,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[{\"expression\":\"METRICS()/1000/60\",\"label\":\"\",\"id\":\"e1\"}],[\"AWS/KinesisAnalytics\",\"downtime\",\"Application\",\"",
                            {
                                "Ref": "KdaApplication28F664DA"
                            },
                            "\",{\"id\":\"m1\",\"visible\":false}]],\"region\":\"",
                            {
                                "Ref": "AWS::Region"
                            },
                            "\",\"period\":300,\"yAxis\":{\"left\":{\"showUnits\":false,\"label\":\"minutes\"}}}},{\"type\":\"metric\",\"x\":12,\"y\":0,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[{\"expression\":\"METRICS()/1000/60\",\"label\":\"\",\"id\":\"e1\"}],[\"AWS/KinesisAnalytics\",\"uptime\",\"Application\",\"",
                            {
                                "Ref": "KdaApplication28F664DA"
                            },
                            "\",{\"id\":\"m1\",\"visible\":false}]],\"region\":\"",
                            {
                                "Ref": "AWS::Region"
                            },
                            "\",\"period\":300,\"yAxis\":{\"left\":{\"showUnits\":false,\"label\":\"minutes\"}}}},{\"type\":\"metric\",\"x\":0,\"y\":12,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[\"AWS/KinesisAnalytics\",\"numberOfFailedCheckpoints\",\"Application\",\"",
                            {
                                "Ref": "KdaApplication28F664DA"
                            },
                            "\"]],\"region\":\"",
                            {
                                "Ref": "AWS::Region"
                            },
                            "\"}},{\"type\":\"metric\",\"x\":12,\"y\":12,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[\"AWS/KinesisAnalytics\",\"lastCheckpointDuration\",\"Application\",\"",
                            {
                                "Ref": "KdaApplication28F664DA"
                            },
                            "\"]],\"region\":\"",
                            {
                                "Ref": "AWS::Region"
                            },
                            "\"}},{\"type\":\"metric\",\"x\":0,\"y\":6,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[\"Kinesis Data Analytics Custom\",\"KDA Snapshot Count\",\"app_name\",\"",
                            {
                                "Ref": "KdaApplication28F664DA"
                            },
                            "\"]],\"region\":\"",
                            {
                                "Ref": "AWS::Region"
                            },
                            "\"}},{\"type\":\"metric\",\"x\":12,\"y\":6,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[\"AWS/Lambda\",\"Duration\",\"FunctionName\",\"",
                            {
                                "Ref": "SnapshotmanagerLambda"
                            },
                            "\"]],\"region\":\"",
                            {
                                "Ref": "AWS::Region"
                            },
                            "\",\"title\":\"Snapshot Duration\"}},{\"type\":\"metric\",\"x\":0,\"y\":18,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[\"AWS/KinesisAnalytics\",\"numRecordsIn\",\"Application\",\"",
                            {
                                "Ref": "KdaApplication28F664DA"
                            },
                            "\"]],\"region\":\"",
                            {
                                "Ref": "AWS::Region"
                            },
                            "\"}},{\"type\":\"metric\",\"x\":12,\"y\":18,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[\"AWS/KinesisAnalytics\",\"numRecordsOut\",\"Application\",\"",
                            {
                                "Ref": "KdaApplication28F664DA"
                            },
                            "\"]],\"region\":\"",
                            {
                                "Ref": "AWS::Region"
                            },
                            "\"}}]}"
                        ]
                    ]
                }
            },
            "Metadata": {
                "aws:cdk:path": "aws-streaming-data-solution-for-kinesis-using-kinesis-data-analytics-and-api-gateway/Monitoring/Dashboard/Resource"
            }
        },
        "MonitoringDowntimeAlarmB4F4F519": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmActions": [{
                    "Ref": "SnapshotsNotificationSNSTopic"
                }],
                "ComparisonOperator": "GreaterThanThreshold",
                "EvaluationPeriods": 2,
                "Dimensions": [
                    {
                        "Name": "Application",
                        "Value": {
                            "Ref": "KdaApplication28F664DA"
                        }
                    }
                ],
                "MetricName": "downtime",
                "Namespace": "AWS/KinesisAnalytics",
                "Period": 600,
                "Statistic": "Average",
                "Threshold": 0,
                "TreatMissingData": "breaching"
            },
            "Metadata": {
                "aws:cdk:path": "aws-streaming-data-solution-for-kinesis-using-kinesis-data-analytics-and-api-gateway/Monitoring/DowntimeAlarm/Resource"
            }
        },
        "MonitoringCheckpointAlarmF5E3E533": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmActions": [{
                    "Ref": "SnapshotsNotificationSNSTopic"
                }],
                "ComparisonOperator": "GreaterThanThreshold",
                "EvaluationPeriods": 2,
                "Dimensions": [
                    {
                        "Name": "Application",
                        "Value": {
                            "Ref": "KdaApplication28F664DA"
                        }
                    }
                ],
                "MetricName": "lastCheckpointDuration",
                "Namespace": "AWS/KinesisAnalytics",
                "Period": 60,
                "Statistic": "Average",
                "Threshold": 500,
                "TreatMissingData": "breaching"
            },
            "Metadata": {
                "aws:cdk:path": "aws-streaming-data-solution-for-kinesis-using-kinesis-data-analytics-and-api-gateway/Monitoring/CheckpointAlarm/Resource"
            }
        },
        "MonitoringCheckpointDurationF5E3E533": {
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": {
                "AlarmActions": [{
                    "Ref": "SnapshotsNotificationSNSTopic"
                }],
                "ComparisonOperator": "GreaterThanOrEqualToThreshold",
                "EvaluationPeriods": 2,
                "Dimensions": [
                    {
                        "Name": "FunctionName",
                        "Value": {
                            "Ref": "SnapshotmanagerLambda"
                        }
                    }
                ],
                "MetricName": "Duration",
                "Namespace": "AWS/Lambda",
                "Period": 600,
                "Statistic": "Average",
                "Threshold": 30000,
                "TreatMissingData": "breaching"
            },
            "Metadata": {
                "aws:cdk:path": "aws-streaming-data-solution-for-kinesis-using-kinesis-data-analytics-and-api-gateway/Monitoring/CheckpointAlarm/Resource"
            }
        },
        "CDKMetadata": {
            "Type": "AWS::CDK::Metadata",
            "Properties": {
                "Analytics": "v2:deflate64:H4sIAAAAAAAA/21SXW/bMAz8LX2XlSUbttelKVYMW1Aj+3pmZdZRI0uCKC0wDP/3UXJip8CedCeR4vHItVxvPsp3d5/hTNWgmtNqUC6gHH5EUCexe7E1BOgwYhA7ZymGpKLYEmHkiFbbVuwSRdcdkFwKCnPKLX5K0aeYEac3OmpnM9mD95w8ilL3pC2Splw1IHQ5YEKj0NDJ4eDM9HE+a2e06ou0GX1lZWAV1sG9aIOjMNA9NyCHL8mqa81bXGPoNBGzUdD7CnJDJEtfzOV9UieM90AoUG3kkAWhSkHH/jG45G9rcjHXsvbvrp3fZsxg6Wkm3LbXLUQ8Q8+JRSubFrdeX/wr8AG9cX2Htvh3w7L1OLmUwdXvove/g9hjPLqmGD+hX8SJtYFixkL2rkFTwq5gq5RLXJL1fMPi9YLmPOajuAwRLJg+akXFta33PCPItv/eiLcXO+NS8weiOrIxeZWe/BQ3CpWfzvlJDg9Ax2cHochfyNZAKK4WMI48R2dS/oAqdd1UWuX9WsyuLnvBPTxONz/dZP8oLLcsX2n1d/1Brj/Jzd0raV0Fbl53KA/T+Q/6gCugMAMAAA=="
            },
            "Metadata": {
                "aws:cdk:path": "aws-streaming-data-solution-for-kinesis-using-kinesis-data-analytics-and-api-gateway/CDKMetadata/Default"
            },
            "Condition": "CDKMetadataAvailable"
        }
    },
    "Outputs": {
        "ApplicationName": {
            "Description": "Name of the Amazon Kinesis Data Analytics application",
            "Value": {
                "Ref": "KdaApplication28F664DA"
            }
        },
        "MyTopicArn": {
            "Description": "Arn of Created SNS Topic",
            "Value": {
                "Ref": "SnapshotsNotificationSNSTopic"
            }
        },
        "Snaphot": {
            "Description": "Table Created using this template.",
            "Value": {
                "Ref": "SnapshotTable"
            }
        }
    },
    "Conditions": {
        "KdaEnableAutoScaling70CD99E0": {
            "Fn::Equals": [
                {
                    "Ref": "EnableAutoScaling"
                },
                "true"
            ]
        },
        "KdaEnableSnapshots603427DA": {
            "Fn::Equals": [
                {
                    "Ref": "EnableSnapshots"
                },
                "true"
            ]
        },
        "SolutionHelperAnonymousDatatoAWSD898118F": {
            "Fn::Equals": [
                {
                    "Fn::FindInMap": [
                        "SolutionHelperAnonymousData14B64A81",
                        "SendAnonymousData",
                        "Data"
                    ]
                },
                "Yes"
            ]
        },
        "CDKMetadataAvailable": {
            "Fn::Or": [
                {
                    "Fn::Or": [
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "af-south-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "ap-east-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "ap-northeast-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "ap-northeast-2"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "ap-south-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "ap-southeast-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "ap-southeast-2"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "ca-central-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "cn-north-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "cn-northwest-1"
                            ]
                        }
                    ]
                },
                {
                    "Fn::Or": [
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "eu-central-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "eu-north-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "eu-south-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "eu-west-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "eu-west-2"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "eu-west-3"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "me-south-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "sa-east-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "us-east-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "us-east-2"
                            ]
                        }
                    ]
                },
                {
                    "Fn::Or": [
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "us-west-1"
                            ]
                        },
                        {
                            "Fn::Equals": [
                                {
                                    "Ref": "AWS::Region"
                                },
                                "us-west-2"
                            ]
                        }
                    ]
                }
            ]
        }
    },
    "Mappings": {
        "SolutionHelperAnonymousData14B64A81": {
            "SendAnonymousData": {
                "Data": "Yes"
            }
        }
    }
}